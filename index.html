<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro IPTV List Player</title>
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <style>
        :root {
            --bg-body: #0d1117;
            --sidebar-bg: #161b22;
            --list-item-bg: #21262d;
            --accent-color: #58a6ff;
            --text-main: #c9d1d9;
            --text-dim: #8b949e;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--sidebar-bg);
            border-right: 1px solid #30363d;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header { padding: 20px; border-bottom: 1px solid #30363d; }
        .sidebar-header h2 { font-size: 1.1rem; margin-bottom: 15px; color: var(--accent-color); }

        #countrySearch {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #30363d;
            background: var(--bg-body);
            color: white;
            outline: none;
        }

        #countryList {
            list-style: none;
            overflow-y: auto;
            flex-grow: 1;
        }

        #countryList li {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #21262d;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        #countryList li:hover { background: var(--list-item-bg); }
        #countryList li.active { background: #1f6feb; color: white; }

        /* Main Section */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: #0d1117;
        }

        .header {
            padding: 20px;
            background: var(--sidebar-bg);
            border-bottom: 1px solid #30363d;
        }

        #channelSearch {
            width: 100%;
            padding: 12px 20px;
            border-radius: 20px;
            border: 1px solid #30363d;
            background: var(--bg-body);
            color: white;
            font-size: 1rem;
        }

        /* Channel List View */
        .channel-list {
            padding: 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .channel-row {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: var(--list-item-bg);
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
        }

        .channel-row:hover {
            border-color: var(--accent-color);
            background: #30363d;
        }

        /* Avatar Circle */
        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
            margin-right: 15px;
            flex-shrink: 0;
            text-transform: uppercase;
        }

        .channel-info { flex-grow: 1; overflow: hidden; }
        .channel-info h4 { font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .channel-info p { font-size: 0.8rem; color: var(--text-dim); margin-top: 2px; }

        /* Video Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content { width: 90%; max-width: 900px; text-align: center; }
        video { width: 100%; border-radius: 12px; background: #000; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .close-btn { position: absolute; top: 20px; right: 30px; font-size: 2.5rem; color: white; cursor: pointer; }

        #loader {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #238636;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            display: none;
            font-size: 0.8rem;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="loader">Syncing Data...</div>

    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>üåç Regions</h2>
            <input type="text" id="countrySearch" placeholder="Search countries...">
        </div>
        <ul id="countryList">
            <li class="active" onclick="filterByCountry('all', this)">üåê Global Channels</li>
        </ul>
    </aside>

    <main class="main-content">
        <div class="header">
            <input type="text" id="channelSearch" placeholder="Find a channel or category...">
        </div>

        <div id="channelList" class="channel-list">
            </div>
    </main>

    <div id="videoModal" class="modal">
        <span class="close-btn">&times;</span>
        <div class="modal-content">
            <video id="videoPlayer" controls autoplay></video>
            <h2 id="nowPlaying" style="margin-top: 15px; font-weight: 400;">Channel Name</h2>
        </div>
    </div>

    <script>
        let allChannels = [];
        let allStreams = [];
        let countries = [];
        let currentCountry = 'all';

        const API = {
            channels: 'https://iptv-org.github.io/api/channels.json',
            streams: 'https://iptv-org.github.io/api/streams.json',
            countries: 'https://iptv-org.github.io/api/countries.json'
        };

        // Colors for Avatars
        const avatarColors = ['#f28b82', '#fbbc04', '#fff475', '#ccff90', '#a7ffeb', '#cbf0f8', '#aecbfa', '#d7aefb'];

        async function init() {
            toggleLoader(true);
            try {
                const [cRes, sRes, cntRes] = await Promise.all([
                    fetch(API.channels),
                    fetch(API.streams),
                    fetch(API.countries)
                ]);

                allChannels = await cRes.json();
                allStreams = await sRes.json();
                countries = await cntRes.json();

                renderCountries();
                renderChannels();
            } catch (err) {
                console.error(err);
                alert("Data loading failed!");
            }
            toggleLoader(false);
        }

        function renderCountries() {
            const list = document.getElementById('countryList');
            countries.sort((a,b) => a.name.localeCompare(b.name)).forEach(c => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${c.flag || 'üè≥Ô∏è'}</span> ${c.name}`;
                li.onclick = () => filterByCountry(c.code, li);
                list.appendChild(li);
            });
        }

        function renderChannels(query = '') {
            const container = document.getElementById('channelList');
            container.innerHTML = '';

            const streamMap = new Map(allStreams.map(s => [s.channel, s]));

            const filtered = allChannels.filter(ch => {
                const matchesCountry = currentCountry === 'all' || ch.country === currentCountry;
                const matchesSearch = ch.name.toLowerCase().includes(query.toLowerCase());
                return matchesCountry && matchesSearch && streamMap.has(ch.id);
            }).slice(0, 100);

            filtered.forEach(ch => {
                const stream = streamMap.get(ch.id);
                const firstLetter = ch.name.charAt(0);
                const randomColor = avatarColors[ch.name.length % avatarColors.length];

                const row = document.createElement('div');
                row.className = 'channel-row';
                row.innerHTML = `
                    <div class="avatar" style="background-color: ${randomColor}">${firstLetter}</div>
                    <div class="channel-info">
                        <h4>${ch.name}</h4>
                        <p>${ch.categories[0] || 'General'} ‚Ä¢ ${ch.country}</p>
                    </div>
                    <div style="color: var(--accent-color)">‚ñ∂</div>
                `;
                row.onclick = () => playStream(stream.url, ch.name);
                container.appendChild(row);
            });
        }

        function playStream(url, name) {
            const modal = document.getElementById('videoModal');
            const video = document.getElementById('videoPlayer');
            document.getElementById('nowPlaying').innerText = name;
            modal.style.display = 'flex';

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
            } else {
                video.src = url;
            }
        }

        function filterByCountry(code, el) {
            currentCountry = code;
            document.querySelectorAll('#countryList li').forEach(li => li.classList.remove('active'));
            el.classList.add('active');
            renderChannels();
        }

        document.getElementById('channelSearch').oninput = (e) => renderChannels(e.target.value);
        
        document.getElementById('countrySearch').oninput = (e) => {
            const val = e.target.value.toLowerCase();
            document.querySelectorAll('#countryList li').forEach((li, i) => {
                if(i===0) return;
                li.style.display = li.innerText.toLowerCase().includes(val) ? 'flex' : 'none';
            });
        };

        document.querySelector('.close-btn').onclick = () => {
            const video = document.getElementById('videoPlayer');
            video.pause();
            document.getElementById('videoModal').style.display = 'none';
        };

        function toggleLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
        }

        init();
    </script>
</body>
</html>
